package com.weather;



import io.appium.java_client.AppiumDriver;
import io.appium.java_client.TouchAction;
import io.appium.java_client.android.AndroidDriver;

import java.io.File;
import java.net.URL;
import java.text.DateFormat;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.HashMap;
import java.util.List;
import java.util.NoSuchElementException;
import java.util.concurrent.TimeUnit;

import org.apache.commons.io.FileUtils;
import org.openqa.selenium.By;
import org.openqa.selenium.Dimension;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.Keys;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.interactions.Action;
import org.openqa.selenium.interactions.DoubleClickAction;
import org.openqa.selenium.interactions.touch.TouchActions;
import org.openqa.selenium.remote.DesiredCapabilities;
import org.openqa.selenium.support.ui.Select;
import org.testng.annotations.AfterClass;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.Test;

import com.thoughtworks.selenium.webdriven.commands.DoubleClick;

public class VideoAds {
	AppiumDriver d;


	@SuppressWarnings("rawtypes")
	@BeforeClass
	public void setUp() throws Exception
	{
		/*System.out.println("Stop the Appium sever");
		AppiumServer.AppiumStop();
		System.out.println("Appium sever is stopped");
		
		System.out.println("===================================");
		
		System.out.println("Start the Appium sever");
		AppiumServer.AppiumStart();
		System.out.println("Appium sever is started and running");
		
		System.out.println("===================================");*/
		
		File app=new File("D:/APK/TWC_600000459_release.apk");
		System.out.println("Caps setting");
		
		DesiredCapabilities caps=new DesiredCapabilities();
		caps.setCapability("deviceName", "Android");
		caps.setCapability("platformName", "Android");
		caps.setCapability("platformVersion", "5.0.1");
//		caps.setCapability("browserName", "chrome");
		//caps.setCapability("app",app.getAbsolutePath());
		caps.setCapability("appPackage", "com.weather.Weather");
		caps.setCapability("appActivity", "com.weather.Weather.app.SplashScreenActivity");
		d = new AndroidDriver(new URL("http://127.0.0.1:4723/wd/hub"), caps);
		System.out.println("Caps done");
		d.manage().timeouts().implicitlyWait(60, TimeUnit.SECONDS);


	}
	@Test
	public void testAd() throws Exception
	{
		
		

		System.out.println("Now in Test method");

		
		Thread.sleep(8000);

		d.findElement(By.id("com.weather.Weather:id/location_actionbar_name")).click();
		Thread.sleep(1000);
		d.findElement(By.name("Cresbard, SD (57435)")).click();
		Thread.sleep(1000);
		
				
		//scrolling down to videos module

		System.out.println("Scrolling started ");
		
		 Dimension dimensions = d.manage().window().getSize();
		  System.out.println("dimensions :: "+dimensions);
		  
		  Double startY1 = dimensions.getHeight() * 0.99;
		  System.out.println("startY value :: "+ startY1);
		  
		  int startY = startY1.intValue();
		  System.out.println("startY value = " + startY);
		  
		  Double endY1 = (double) (dimensions.getHeight()/60);  //  dimensions.getHeight()  0.2;  == 512.0
		  System.out.println("endY value :: " + endY1);
		  
		       int endY = endY1.intValue(); 
		       System.out.println("scroll to end = " + endY);
		  
		  
		
		/*//WebElement Scroll_1 = d.findElement(By.id("com.weather.Weather:id/now_circle_include"));
		WebElement Scroll_1 = d.findElement(By.id("com.weather.Weather:id/left_text"));
		int topY = Scroll_1.getLocation().getY();
		int bottomY = topY + Scroll_1.getSize().getHeight();
		int centerX = Scroll_1.getLocation().getX() + (Scroll_1.getSize().getWidth() / 2);
		//	System.out.println("TopY :" + topY + "Bottom :" + bottomY + "center :" + centerX);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);
		d.swipe(centerX, bottomY, centerX, topY, 10000);*/
		
		
		  for (int i = 0; i < dimensions.getHeight(); i++) 
			{
				
				WebElement videoModule = null;

				try {
					videoModule = d.findElementById("com.weather.Weather:id/video_title");

				 } catch (Exception e) {
					// System.out.println(e);	
				 }
				
				if(videoModule!= null && videoModule.isDisplayed())	
				{ 
					System.out.println("video section is displayed and tap on vedio section");

//					d.findElement(By.id("com.weather.Weather:id/video2_grid_item_imageholder")).click();
					d.findElement(By.id("com.weather.Weather:id/video_title")).click();					

					if(d.findElement(By.xpath("//android.view.View[@content-desc='Learn More']")).isDisplayed())
					{
						WebElement AdTime_LearnMore=d.findElement(By.xpath("//android.view.View[contains(@content-desc,'Ad')]"));
						System.out.println("LearnMore presented Time= "+AdTime_LearnMore);
					}
					else
					{
						System.out.println("Unable to get learnmore ");
					}
					
					Thread.sleep(10000);
					 
				}else
				{
	                System.out.println("video section is not presented and scrolling down");
					
	                d.swipe(0, startY,0, endY,2000);
					
				}
			}
		  
		  
	/*	  
		System.out.println("Scrolling ended at Videos module");
		//Clicking on Video
		d.findElement(By.id("com.weather.Weather:id/video2_grid_item_imageholder")).click();
		
		if(d.findElement(By.xpath("//android.view.View[@content-desc='Learn More']")).isDisplayed())
		{
			WebElement AdTime_LearnMore=d.findElement(By.xpath("//android.view.View[contains(@content-desc,'Ad')]"));
			System.out.println("LearnMore presented Time= "+AdTime_LearnMore);
		}
		else
		{
			System.out.println("Unable to get learnmore ");
		}
		
		Thread.sleep(10000);
		*/
		
		
	/*	//ad Time 
		WebElement adTime=d.findElement(By.xpath("//android.view.View[contains(@content-desc,'Ad')]"));
		System.out.println("/n/n/n"+"ad Time="+adTime.getAttribute("name"));
		//screenshot with date format 
		DateFormat dateFormat = new SimpleDateFormat("dd-MM-yyyy HH-mm-ss");
		Date date = new Date();
		
		File scrFile = d.getScreenshotAs(OutputType.FILE);
	    FileUtils.copyFile(scrFile, new File("G:/mahesh_weather/TWC/screenshots/screenshots"+dateFormat.format(date)+".png"));
	    Thread.sleep(2000);
	   	
		File scrFile2 = d.getScreenshotAs(OutputType.FILE);
	   FileUtils.copyFile(scrFile2, new File("G:/mahesh_weather/TWC/screenshots/screenshots"+dateFormat.format(date)+".png"));
	    // locating learn more 
	    WebElement learnMore=d.findElement(By.xpath("//android.view.View[@content-desc='Learn More']"));
	    
		System.out.println("displaying learnmore ===="+"\n"+learnMore.getAttribute("name"));
		//locating ad time 
			
		WebElement adTimeLast=d.findElement(By.xpath("//android.view.View[contains(@content-desc,'Ad')]"));
		System.out.println("/n/n/n"+"ad Time="+adTimeLast.getAttribute("name"));
		
		Thread.sleep(5000);
		//clicking on 4 th video 
	    
		WebElement video_4=(WebElement) d.findElements(By.id("com.weather.Weather:id/video_row")).get(3);
				video_4.click();
		
		
		File scrFile3 = d.getScreenshotAs(OutputType.FILE);
	    FileUtils.copyFile(scrFile3, new File("G:/mahesh_weather/TWC/screenshots/screenshots"+dateFormat.format(date)+".png"));
					 	
	    // locating learn more 
	    WebElement learnmore2=d.findElement(By.xpath("//android.view.View[@content-desc='Learn More']"));
	    
		System.out.println("displaying learnmore ===="+"\n"+learnmore.getAttribute("name"));
		//locating ad time 
		WebElement adTime2=d.findElement(By.xpath("//android.view.View[starts-with(@content-desc,' Ad :')]"));
		
		System.out.println("/n/n/n"+"ad Time="+adTime2.getAttribute("name"));
		*/
		
		
				Thread.sleep(10000);

	}
	@AfterClass
	public void stop()
	{
		d.closeApp();

	}
}



